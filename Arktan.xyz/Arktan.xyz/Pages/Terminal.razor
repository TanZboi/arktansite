@page "/"
@inject IJSRuntime JSRuntime
<div class="terminal">
    <div class="output">
        @foreach (var line in outputLines.AsEnumerable())
        {
            <p>@line</p>
        }
    </div>

    <div class="input-line">
        <span class="prompt">$ </span>
        <input @bind="currentInput" @bind:event="oninput" @onkeydown="HandleKeyDown" class="input" />
        <span class="cursor">â–ˆ</span>
    </div>
</div>

@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeVoidAsync("initShader");
        }
    }
    
    private List<string> outputLines = new();
    private string currentInput = "";

    private void HandleKeyDown(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            ProcessCommand(currentInput);
            currentInput = "";
        }
    }
    
    private ElementReference outputDiv;

    private async Task ScrollToBottom()
    {
        await JSRuntime.InvokeVoidAsync("scrollToBottom", outputDiv); // Scroll to the bottom of the output
    }

    private void ProcessCommand(string command)
    {
        // Add the command itself
        outputLines.Insert(0, "$ " + command);
        
        string response; // The response to the command
        if (command == "art")
            response = "Displaying artwork...";
        else if (command == "music")
            response = "Opening music links...";
        else
            response = "Unknown command. Try 'art' or 'music'.";
        
        outputLines.Insert(1, response); // Add the response to the output

        ScrollToBottom(); // Scroll to the bottom of the output
    }

    
}
